var e=require("react"),r=require("@saas-ui/hooks"),t=require("@chakra-ui/react"),n=require("@chakra-ui/utils"),o=require("@saas-ui/layout"),i=require("@saas-ui/forms"),a=require("@saas-ui/button");function l(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach(function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}}),r.default=e,r}var u=/*#__PURE__*/l(e),s=u.useState,c=u.useContext,d=u.useEffect,m=u.useCallback,p=(0,u.createContext)(null),f=function(){var e=c(p);if(null===e)throw new Error("Auth context missing, did you forget to wrap your app in AuthProvider?");return e},v=function(e){var t=(void 0===e?{}:e).action,n=void 0===t?"logIn":t,o=f();return r.usePromise(o[n]||o.logIn)},E=function(){var e=f();return r.usePromise(e.verifyOtp)},h=function(){var e=f();return r.usePromise(e.resetPassword)},b=function(){var e=f();return r.usePromise(e.updatePassword)};function g(){return g=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},g.apply(this,arguments)}function L(e,r){if(null==e)return{};var t,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r.indexOf(t=i[n])>=0||(o[t]=e[t]);return o}var _=["children"],y=function(e){var r,n=e.children,o=L(e,_),i=g({p:6,colorScheme:"gray"},null==(r=t.useTheme().components.LoginButton)?void 0:r.defaultProps);/*#__PURE__*/return u.createElement(a.Button,g({},i,o),n)};n.__DEV__&&(y.displayName="LoginButton");var w=["title","description"],P=function(e){var r=e.title,n=e.description,o=L(e,w);/*#__PURE__*/return u.createElement(t.Alert,g({status:"success",variant:"subtle",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},o),/*#__PURE__*/u.createElement(t.AlertIcon,{boxSize:"40px",mr:0}),/*#__PURE__*/u.createElement(t.AlertTitle,{mt:4,mb:1,fontSize:"lg"},r),/*#__PURE__*/u.createElement(t.AlertDescription,{maxWidth:"sm"},n))};n.__DEV__&&(P.displayName="AuthFormSuccess");var S=["action","onSuccess","onError","onValidationError","submitLabel","emailLabel","defaultValues","renderSuccess","children"];function k(e){/*#__PURE__*/return u.createElement(P,{title:"Check your mailbox!",description:/*#__PURE__*/u.createElement(u.Fragment,null,"We've sent a magic link to "+(e.email||"your email address")+".",/*#__PURE__*/u.createElement("br",null),"Click on the link to continue.")})}n.__DEV__&&(k.displayName="MagicLinkSuccess");var x=function(e){var r=e.action,t=void 0===r?"logIn":r,n=e.onSuccess,o=void 0===n?function(){return null}:n,a=e.onError,l=void 0===a?function(){return null}:a,s=e.onValidationError,c=e.submitLabel,d=void 0===c?"Continue with Email":c,m=e.emailLabel,p=void 0===m?"Email":m,f=e.defaultValues,E=e.renderSuccess,h=void 0===E?function(e){/*#__PURE__*/return u.createElement(k,{email:null==e?void 0:e.email})}:E,b=e.children,_=L(e,S),w=v({action:t}),P=w[0],x=P.isLoading,V=w[1];return P.isResolved?h(P.data):/*#__PURE__*/u.createElement(i.Form,g({onSubmit:function(e){return V({email:e.email}).then(o).catch(l)},onError:s,defaultValues:g({email:""},f)},_),/*#__PURE__*/u.createElement(i.FormLayout,null,/*#__PURE__*/u.createElement(i.Field,{name:"email",label:p,type:"email",rules:{required:!0},autoComplete:"email"}),b,/*#__PURE__*/u.createElement(y,{type:"submit",isLoading:x,width:"full",label:d})))};n.__DEV__&&(x.displayName="MagicLinkForm");var V=["action","onSuccess","onError","onValidationError","submitLabel","emailLabel","passwordLabel","defaultValues","children","renderSuccess"],F=function(e){var r=e.action,t=void 0===r?"logIn":r,n=e.onSuccess,o=void 0===n?function(){return null}:n,a=e.onError,l=void 0===a?function(){return null}:a,s=e.onValidationError,c=e.submitLabel,d=void 0===c?"Log in":c,m=e.emailLabel,p=void 0===m?"Email":m,f=e.passwordLabel,E=void 0===f?"Password":f,h=e.defaultValues,b=e.children,_=e.renderSuccess,w=void 0===_?function(){/*#__PURE__*/return u.createElement(P,{title:"Success!",description:"Check your mailbox to verify your account."})}:_,S=L(e,V),k=v({action:t}),x=k[0],F=x.isLoading,A=k[1];return x.isResolved&&"signUp"===t?w(x.data):/*#__PURE__*/u.createElement(i.Form,g({onSubmit:function(e){return A(e).then(o).catch(l)},onError:s,defaultValues:g({email:"",password:""},h)},S),/*#__PURE__*/u.createElement(i.FormLayout,null,/*#__PURE__*/u.createElement(i.Field,{name:"email",label:p,type:"email",rules:{required:!0},autoComplete:"email"}),/*#__PURE__*/u.createElement(i.Field,{name:"password",label:E,type:"password",rules:{required:!0},autoComplete:"current-password"}),b,/*#__PURE__*/u.createElement(y,{type:"submit",width:"full",isLoading:F},d)))};n.__DEV__&&(F.displayName="PasswordForm");var A=["onSuccess","onError","onValidationError","submitLabel","label","helpText","pinLength","children","renderSuccess"],O=function(e){var r=e.onSuccess,t=void 0===r?function(){return null}:r,n=e.onError,o=void 0===n?function(){return null}:n,a=e.onValidationError,l=e.submitLabel,s=void 0===l?"Verify":l,c=e.label,d=e.helpText,m=e.pinLength,p=void 0===m?4:m,f=e.children,v=e.renderSuccess,h=void 0===v?function(){/*#__PURE__*/return u.createElement(P,{title:"Success!",description:"You are now logged in."})}:v,b=L(e,A),_=E(),w=_[0],S=w.isLoading,k=w.data,x=_[1];return k?h(k):/*#__PURE__*/u.createElement(i.Form,g({onSubmit:function(e){return x(e).then(t).catch(o)},onError:a,defaultValues:{otp:""}},b),/*#__PURE__*/u.createElement(i.FormLayout,null,/*#__PURE__*/u.createElement(i.Field,{name:"otp",label:c,help:d,type:"pin",pinLength:p,rules:{required:!0}}),f,/*#__PURE__*/u.createElement(y,{type:"submit",width:"full",isLoading:S},s)))};O.defaultProps={helpText:"You can find your one-time password in the Google Authenticator or Authy app.",submitLabel:"Verify",label:"Your verification code"},n.__DEV__&&(O.displayName="OtpForm");var C=["children"],N=function(e){var r,n=e.children,o=L(e,C),i=g({p:6,variant:"outline"},null==(r=t.useTheme().components.ProviderButton)?void 0:r.defaultProps);/*#__PURE__*/return u.createElement(a.Button,g({},i,o),n)};n.__DEV__&&(N.displayName="ProviderButton");var D=["providers","redirectTo","label"],T=function(e){var r=e.providers,n=e.redirectTo,o=e.label,i=void 0===o?"Continue with":o,a=L(e,D),l=f().logIn;if(!r)return null;var s=function(e){return function(){try{return Promise.resolve(l({provider:e},{redirectTo:n})).then(function(){})}catch(e){return Promise.reject(e)}}};/*#__PURE__*/return u.createElement(t.SimpleGrid,g({spacing:4},a),Object.entries(r).map(function(e){var r=e[0],n=e[1],o=n.name,a=n.icon,l=n.color;/*#__PURE__*/return u.createElement(N,{onClick:s(r),color:l,leftIcon:a&&/*#__PURE__*/u.createElement(t.Icon,{as:a}),key:r},i," ",o)}))};n.__DEV__&&(T.displayName="Providers");var I=["onSuccess","onError","onValidationError","submitLabel","emailLabel","label","helpText","children","renderSuccess"],U=function(e){var r=e.onSuccess,t=void 0===r?function(){return null}:r,n=e.onError,o=void 0===n?function(){return null}:n,a=e.onValidationError,l=e.submitLabel,s=e.emailLabel,c=e.label,d=e.children,m=e.renderSuccess,p=void 0===m?function(){/*#__PURE__*/return u.createElement(P,{title:"Success!",description:"Please check your email for instructions to reset your password."})}:m,f=L(e,I),v=h(),E=v[0],b=E.isLoading,_=E.data,w=v[1];return _?p(_):/*#__PURE__*/u.createElement(i.Form,g({onSubmit:function(e){return w(e).then(t).catch(o)},onError:a,defaultValues:{email:""}},f),/*#__PURE__*/u.createElement(i.FormLayout,null,/*#__PURE__*/u.createElement(i.Field,{name:"email",label:null!=c?c:s,type:"email",rules:{required:!0},autoComplete:"email"}),d,/*#__PURE__*/u.createElement(y,{type:"submit",width:"full",isLoading:b},l)))};U.defaultProps={submitLabel:"Reset password",emailLabel:"Your email address"},n.__DEV__&&(U.displayName="ForgotPasswordForm");var j=["onSuccess","onError","onValidationError","submitLabel","passwordLabel","label","confirmLabel","helpText","children"],G=function(e){var r=e.onSuccess,t=void 0===r?function(){return null}:r,n=e.onError,o=void 0===n?function(){return null}:n,a=e.onValidationError,l=e.submitLabel,s=e.passwordLabel,c=e.label,d=e.confirmLabel,m=e.children,p=L(e,j),f=b(),v=f[0].isLoading,E=f[1],h=u.useRef(null),_=u.useCallback(function(e){var r;return e===(null==(r=h.current)?void 0:r.getValues("password"))},[]);/*#__PURE__*/return u.createElement(i.Form,g({onSubmit:function(e){return E({password:e.password}).then(t).catch(o)},onError:a,defaultValues:{password:"",confirmPassword:""},ref:h},p),/*#__PURE__*/u.createElement(i.FormLayout,null,/*#__PURE__*/u.createElement(i.Field,{name:"password",label:null!=c?c:s,type:"password",rules:{required:!0},autoComplete:"current-password"}),/*#__PURE__*/u.createElement(i.Field,{name:"confirmPassword",label:d,type:"password",rules:{validate:_},autoComplete:"new-password"}),m,/*#__PURE__*/u.createElement(y,{type:"submit",width:"full",isLoading:v},l)))};G.defaultProps={submitLabel:"Update password",passwordLabel:"New password",confirmLabel:"Confirm password"},n.__DEV__&&(G.displayName="UpdatePasswordForm");var R=["type","providers","title","providerLabel","dividerLabel","footer"],q=["children"],B=["title","footer"],W=["title","footer"],M=["title","footer"],z=t.createStylesContext("AuthForm"),Y=z[0],H=z[1],J=function(e){var r,t=e.type,n=e.providers,o=e.title,i=e.providerLabel,a=e.dividerLabel,l=e.footer,s=L(e,R);return r=/*#__PURE__*/u.createElement("password"===t?F:x,s),/*#__PURE__*/u.createElement(K,null,"string"==typeof o?/*#__PURE__*/u.createElement(X,null,o):o,n&&/*#__PURE__*/u.createElement(u.Fragment,null,/*#__PURE__*/u.createElement(T,{providers:n,label:i}),/*#__PURE__*/u.createElement(Q,{label:a})),r,l)};J.defaultProps={type:"magiclink",providerLabel:"Continue with",dividerLabel:"or continue with"},n.__DEV__&&(J.displayName="AuthForm");var K=function(e){var r=e.children,o=t.useMultiStyleConfig("AuthForm",e),i=t.omitThemingProps(e),a=g({display:"flex",flexDirection:"column",alignItems:"stretch",width:"full"},o.container);/*#__PURE__*/return u.createElement(Y,{value:o},/*#__PURE__*/u.createElement(t.chakra.div,g({__css:a},i,{className:n.cx("saas-auth-form",e.className)}),r))};n.__DEV__&&(K.displayName="AuthFormContainer");var Q=function(e){var r=g({my:4},H().divider);/*#__PURE__*/return u.createElement(o.Divider,g({},e,{sx:r}))},X=function(e){var r=e.children,o=L(e,q),i=g({fontSize:"2xl",fontWeight:"bold",textAlign:"center",mb:8},H().title);/*#__PURE__*/return u.createElement(t.chakra.h2,g({__css:i},o,{className:n.cx("saas-auth-form__title",o.className)}),r)};n.__DEV__&&(X.displayName="AuthFormTitle");var Z=function(e){/*#__PURE__*/return u.createElement(J,g({action:"logIn"},e))};Z.defaultProps={title:"Log in",submitLabel:"Log in"},n.__DEV__&&(Z.displayName="LoginView");var $=function(e){/*#__PURE__*/return u.createElement(J,g({action:"signUp"},e))};$.defaultProps={title:"Sign up",submitLabel:"Sign up"},n.__DEV__&&($.displayName="SignupView");var ee=function(e){var r=e.title,t=e.footer,n=L(e,B);/*#__PURE__*/return u.createElement(K,null,"string"==typeof r?/*#__PURE__*/u.createElement(X,null,r):r,/*#__PURE__*/u.createElement(O,n),t)};ee.defaultProps={title:"One-time password"},n.__DEV__&&(ee.displayName="OtpView");var re=function(e){var r=e.title,t=e.footer,n=L(e,W);/*#__PURE__*/return u.createElement(K,null,"string"==typeof r?/*#__PURE__*/u.createElement(X,null,r):r,/*#__PURE__*/u.createElement(U,n),t)};re.defaultProps={title:"Forgot password"},n.__DEV__&&(re.displayName="ForgotPasswordView");var te=function(e){var r=e.title,t=e.footer,n=L(e,M);/*#__PURE__*/return u.createElement(K,null,"string"==typeof r?/*#__PURE__*/u.createElement(X,null,r):r,/*#__PURE__*/u.createElement(G,n),t)};te.defaultProps={title:"Choose a new password"},n.__DEV__&&(te.displayName="UpdatePasswordView");var ne=["view","providers","signupLink","loginLink","forgotLink","backLink","noAccount","haveAccount"],oe={LOGIN:"login",SIGNUP:"signup",FORGOT_PASSWORD:"forgot_password",UPDATE_PASSWORD:"update_password",OTP:"otp"},ie=function(e){var r=e.view,n=void 0===r?oe.LOGIN:r,o=e.providers,i=e.signupLink,a=e.loginLink,l=e.forgotLink,s=e.backLink,c=e.noAccount,d=e.haveAccount,m=L(e,ne),p=m.type,f=u.useState(n),v=f[0],E=f[1];switch(u.useEffect(function(){E(n)},[n]),v){case oe.LOGIN:/*#__PURE__*/return u.createElement(Z,g({providers:o,footer:/*#__PURE__*/u.createElement(ae,{onClick:function(){return E(oe.SIGNUP)},label:c,link:i})},m),"password"===p&&("string"==typeof l?/*#__PURE__*/u.createElement(t.Link,{fontSize:"md",color:"muted",float:"right",onClick:function(){return E(oe.FORGOT_PASSWORD)}},l):l));case oe.SIGNUP:/*#__PURE__*/return u.createElement($,g({providers:o,footer:/*#__PURE__*/u.createElement(ae,{onClick:function(){return E(oe.LOGIN)},label:d,link:a})},m));case oe.FORGOT_PASSWORD:/*#__PURE__*/return u.createElement(re,g({footer:/*#__PURE__*/u.createElement(ae,{onClick:function(){return E(oe.LOGIN)},link:s})},m));case oe.UPDATE_PASSWORD:/*#__PURE__*/return u.createElement(te,m);case oe.OTP:/*#__PURE__*/return u.createElement(ee,m)}return null},ae=function(e){var r=e.label,n=e.link,o=e.onClick;/*#__PURE__*/return u.createElement(t.chakra.div,{__css:{textAlign:"center",py:8,fontSize:"md"}},r&&/*#__PURE__*/u.createElement(t.chakra.span,{color:"muted"},r)," ","string"==typeof n?/*#__PURE__*/u.createElement(t.Link,{onClick:o},n):n)};ie.defaultProps={noAccount:"No account yet?",haveAccount:"Already have an account?",signupLink:"Sign up",loginLink:"Log in",forgotLink:"Forgot password?",backLink:"Back to log in"},n.__DEV__&&(ie.displayName="Auth"),exports.Auth=ie,exports.AuthContext=p,exports.AuthForm=J,exports.AuthFormContainer=K,exports.AuthFormDivider=Q,exports.AuthFormTitle=X,exports.AuthProvider=function(e){var r=e.onLoadUser,t=void 0===r?function(){return Promise.resolve(null)}:r,n=e.onSignup,o=void 0===n?function(){return Promise.resolve(null)}:n,i=e.onLogin,a=void 0===i?function(){return Promise.resolve(null)}:i,l=e.onVerifyOtp,c=void 0===l?function(){return Promise.resolve(null)}:l,f=e.onLogout,v=void 0===f?function(){return Promise.resolve()}:f,E=e.onAuthStateChange,h=e.onGetToken,b=e.onResetPassword,g=e.onUpdatePassword,L=e.children,_=s(!1),y=_[0],w=_[1],P=s(),S=P[0],k=P[1],x=s(!0),V=x[0],F=x[1];d(function(){if(E){var e=E(function(e){w(!!e)});return function(){null==e||e()}}},[]),d(function(){O()},[y]);var A=m(function(){try{return Promise.resolve(function(e,r){try{var t=function(){var e=function(){if(h)return Promise.resolve(h()).then(function(e){w(!!e)})}();if(e&&e.then)return e.then(function(){})}()}catch(e){return r()}return t&&t.then?t.then(void 0,r):t}(0,function(){w(!1)}))}catch(e){return Promise.reject(e)}},[h]);d(function(){return window.addEventListener("focus",A),A(),function(){window.removeEventListener("focus",A)}},[A]);var O=m(function(){try{var e=function(){F(!1)},r=function(){if(y)return Promise.resolve(t()).then(function(e){e?k(e):w(!1)})}();return Promise.resolve(r&&r.then?r.then(e):e())}catch(e){return Promise.reject(e)}},[t,y]),C=m(function(e,r){try{return Promise.resolve(o(e,r)).then(function(e){return A(),e})}catch(e){return Promise.reject(e)}},[o]),N=m(function(e,r){try{return Promise.resolve(a(e,r)).then(function(e){return A(),e})}catch(e){return Promise.reject(e)}},[a]),D=m(function(){try{return Promise.resolve(v()).then(function(){k(null),w(!1)})}catch(e){return Promise.reject(e)}},[v]),T=m(function(e,r){try{return Promise.resolve(c(e,r))}catch(e){return Promise.reject(e)}},[c]),I=m(function(e,r){return Promise.resolve(null==b?void 0:b(e,r)).then(function(){})},[b]),U=m(function(e,r){return Promise.resolve(null==g?void 0:g(e,r)).then(function(){})},[g]),j=m(function(){return Promise.resolve(null==h?void 0:h())},[h]);/*#__PURE__*/return u.createElement(p.Provider,{value:{isAuthenticated:y,isLoggingIn:y&&!S,isLoading:V,user:S,signUp:C,logIn:N,logOut:D,verifyOtp:T,loadUser:O,getToken:j,resetPassword:I,updatePassword:U}},L)},exports.ForgotPasswordView=re,exports.LoginButton=y,exports.LoginView=Z,exports.MagicLinkForm=x,exports.MagicLinkSuccess=k,exports.OtpForm=O,exports.OtpView=ee,exports.PasswordForm=F,exports.ProviderButton=N,exports.Providers=T,exports.SignupView=$,exports.UpdatePasswordView=te,exports.VIEWS=oe,exports.useAuth=f,exports.useCurrentUser=function(){return f().user},exports.useLogin=v,exports.useOtp=E,exports.useResetPassword=h,exports.useSignUp=function(){var e=f();return r.usePromise(e.signUp)},exports.useUpdatePassword=b;
//# sourceMappingURL=index.js.map
